\begin{problem}
  Let $\Sigma$ be an alphabet, $L \subseteq \Sigma^*$,
  and $\# \notin \Sigma$.
  Define the language
  \[ 
    \textsc{Intersperse}(\#, L) := 
    \set{a_1 \# a_2 \# \ldots \# a_n},
    \text{ each $a_i \in \Sigma$ and $a_1a_2 \ldots a_n \in L$}.
  \]

  \step
  Let $M_1 = (Q, \Sigma, \Gamma, \delta, q_0, F)$ be a PDA
  that recognizes $L$.
  Formally describe a PDA that recognizes $\textsc{Intersperse}(\#, L)$.
  Also give a high-level proof that your PDA works correctly.
\end{problem}
\begin{Answer}
  Let $M_2 = (Q \times \set{1, \#, \eps}, \Sigma \cup \set{\#}, \Gamma, \delta_2, (q_0, 1), F_2)$ be a PDA
  such that:
  \begin{itemize}
    \item $F_2 = \set{(q, \eps): q \in F} \cup \set{(q, \#): q \in F}$
    \item $\delta_2$ is defined as follows:
    \begin{align*}
      \delta_2((q, x), a, \gamma) = 
      \begin{cases}
        \set{(q, 1)} & \text{ if $x = \eps$, and $a = \gamma = \eps$. } \\
        \set{(q, 1)} & \text{ if $x = \#$, $a = \#$, and $\gamma = \eps$. } \\
        \set{(\delta(q, a, \gamma), \#)} & \text{ if $a \in \Sigma$. } \\
        \set{(\delta(q, a, \gamma), \eps)} & \text{ if $a = \eps$. } \\
      \end{cases}
    \end{align*}
  \end{itemize}
  \begin{claim}
    $M_2$ recognizes $\textsc{Intersperse}(\#, L)$.

    \step
    \begin{proof}
      $M_2$ is a modification of $M$ where at every non-epsilon transition,
      we require that a $\#$ symbol be read before proceeding to
      read the next symbol.
        % Draw the PDA
        \begin{figure}[H]
          \begin{tikzpicture}
            \node[state, initial] (q0) at (0, 0) {$a$};
            \node[state] at (10, 0) (q1) {$b$};
            \node[state] at (5, 3) (q2) {$b_{\eps}$};
            \node[state] at (5, -3) (q3) {$b_{\#}$};
            \draw (q0) edge[above, pos=0.7, dashed] node {$x, y \to z$ (old transition)} (q1)
                  (q0) edge[below, pos=0.3] node {\crim{$x, y \to z$ if $x \ne \eps$}} (q3)
                  (q0) edge[above, pos=0.3] node {\crim{$x, y \to z$ if $x = \eps$}} (q2)
                  (q3) edge[below, pos=0.3] node {\green{$\#, \eps \to \eps$}} (q1)
                  (q2) edge[above, pos=0.3] node {\green{$\eps, \eps \to \eps$}} (q1);
          \end{tikzpicture}
          \caption{Modification of Transitions to Require $\#$ between any two non-epsilon Symbols.}
        \end{figure}
    \end{proof}
  \end{claim}
\end{Answer}
